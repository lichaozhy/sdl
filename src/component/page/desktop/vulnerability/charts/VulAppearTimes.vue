<template>
  <div>
    <b-breadcrumb
			:items="[
				{ text: '管理', active: true },
				{ text: '漏洞出现频率', active: true },
			]"
		/>

    <chart-canvas
      style="height:300px"
      :options="{
				credits: { enabled: false },
        chart: {
          type: 'bar'
        },
        title: {
          text: null
        },
        xAxis: {
          title: {
            text: '漏洞名称'
          },
          categories: [
            'SQL注入漏洞', 
            '反射型跨站漏洞', 
            '暴力攻击', 
            '不安全的HTTP方法', 
            '登录信息明文传输', 
            '接口越权访问漏洞', 
            '系统后台弱口令', 
            '脆弱的SSL加密算法', 
            '第三方框架版本过低', 
            '脚本上传漏洞'   
          ]
        },
        yAxis: {
          min: 0,
          title: {
            text: '记录数'
          }
        },
        legend: {
          reversed: true 
        },
        plotOptions: {
          series: {
            stacking: 'normal'
          }
        },
        series: [
        {
          name: '40',
          data: [2, 1, 1, 0, 1, 0, 0, 2, 0, 0]
        }, 
        {
          name: '39',
          data: [1, 1, 0, 0, 2, 1, 0, 0, 1, 0]
        }, 
        {
          name: '38',
          data: [1, 0, 1, 0, 1, 2, 1, 0, 0, 0]
        }, 
        {
          name: '37',
          data: [1, 0, 0, 1, 0, 0, 0, 0, 1, 0]
        }, 
        {
          name: '36',
          data: [1, 0, 0, 1, 0, 0, 1, 0, 0, 1]
        }, 
        {
          name: '35',
          data: [1, 1, 2, 2, 0, 0, 1, 1, 0, 1]
        }, 
        {
          name: '34',
          data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        }, 
        {
          name: '33',
          data: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0]
        }, 
        {
          name: '32',
          data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        }, 
        {
          name: '31',
          data: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0]
        }, 
        {
          name: '30',
          data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        }
        ]
      }"
    />

    <b-table
			bordered
			small
			striped
			overflow:hidden
			id="admin-overview-table"
			:items="bocData"
			:per-page="perPage"
      :current-page="currentPage"
			class="text-center overview-table"
			:fields="[
				{ key: 'general', label: '总属' },
				{ key: 'branch', label: '分属' },
				{ key: 'projectName', label: '项目名称' },
				{ key: 'projectGroup', label: '项目组' },
				{ key: 'vulnerabilityName', label: '漏洞名称' },
				{ key: 'level', label: '危害级别' },
				{ key: 'status', label: '修复情况' },
				{ key: 'developer', label: '开发' },
				{ key: 'show_details', label: '' },
			]"
		>
			<template slot="show_details" slot-scope="row">
				<b-button size="sm"
					@click="row.toggleDetails"
				>{{ row.detailsShowing ? '隐藏' : '显示'}}详情</b-button>
			</template>

			<template slot="row-details" slot-scope="row">
				<span>版本:&nbsp;{{ row.item.version }}</span>
				<span class="ml-5">漏洞录入时间:&nbsp;{{ format(row.item.vulnerabilityEntryTime) }}</span>
				<span class="ml-5">漏洞编号:&nbsp;{{ row.item.vulnerabilityNumber }}</span>
				<span class="ml-5">漏洞复测时间:&nbsp;{{ format(row.item.vulnerabilityRetestTime) }}</span>
				<span class="ml-5">漏洞修复时间:&nbsp;{{ format(row.item.vulnerabilityRepairTime) }}</span>
			</template>
			
			<template
				slot="repairTime"
				slot-scope="data"
			>{{ data.item.averageRepairTime }}个工作日</template>
		</b-table>

		<div class="mt-3">
			<b-pagination 
				v-model="currentPage" 
				:total-rows="rows" 
				align="center"
				:per-page="perPage"
				aria-controls="admin-overview-table"
			></b-pagination>
		</div>
  </div>
</template>

<script>
import bocData from '../../../../../plugin/backend/boc.json';

export default {
	data() {
		return {
			bocData,
			perPage: 9,
			currentPage: 1,
		}
	},
	computed: {
		rows() {
			return this.bocData.length;
		}		
	},
}
</script>

<style>

</style>
