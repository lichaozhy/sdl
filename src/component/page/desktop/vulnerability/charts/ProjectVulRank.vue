<template>
  <div>
    <b-breadcrumb
			:items="[
				{ text: '管理', active: true },
				{ text: '项目漏洞排名', active: true },
			]"
		/>

    <chart-canvas
      style="height:300px"
      :options="{
				credits: { enabled: false },
        chart: {
          type: 'bar'
        },
        title: {
          text: null
        },
        xAxis: {
          title: {
            text: '项目(系统)名称'
          },
          categories: [
            '手机银行信用卡专版', 
            '金融租赁', 
            '资金交易管理系统', 
            '大连分行微信银行', 
            '合肥分行短信平台', 
            '南昌分行微信公众号', 
            '信用卡中心', 
            '金融租赁邮箱管理系统', 
            '天津公积金贷前回收', 
            '人事服务平台' 
          ]
        },
        yAxis: {
          min: 0,
          title: {
            text: '记录数'
          }
        },
        legend: {
          reversed: true 
        },
        plotOptions: {
          series: {
            stacking: 'normal'
          }
        },
        series: [{
          name: '低危漏洞',
          data: [5, 3, 4, 3, 2, 3, 2, 1, 1, 1]
        }, {
          name: '中危漏洞',
          data: [3, 5, 4, 3, 3, 2, 4, 3, 2, 1]
        }, {
          name: '高危漏洞',
          data: [7, 5, 4, 3, 2, 4, 2, 2, 1, 1]
        }, {
          name: '建议修复',
          data: [4, 3, 3, 4, 4, 2, 1, 3, 2, 1]
        }]
      }"
    />

    <b-table
			bordered
			small
			striped
			overflow:hidden
			id="admin-overview-table"
			:items="bocData"
			:per-page="perPage"
      :current-page="currentPage"
			class="text-center overview-table"
			:fields="[
				{ key: 'general', label: '总属' },
				{ key: 'branch', label: '分属' },
				{ key: 'projectName', label: '项目名称' },
				{ key: 'projectGroup', label: '项目组' },
				{ key: 'vulnerabilityName', label: '漏洞名称' },
				{ key: 'level', label: '危害级别' },
				{ key: 'status', label: '修复情况' },
				{ key: 'developer', label: '开发' },
				{ key: 'show_details', label: '' },
			]"
		>
			<template slot="show_details" slot-scope="row">
				<b-button size="sm"
					@click="row.toggleDetails"
				>{{ row.detailsShowing ? '隐藏' : '显示'}}详情</b-button>
			</template>

			<template slot="row-details" slot-scope="row">
				<span>版本:&nbsp;{{ row.item.version }}</span>
				<span class="ml-5">漏洞录入时间:&nbsp;{{ format(row.item.vulnerabilityEntryTime) }}</span>
				<span class="ml-5">漏洞编号:&nbsp;{{ row.item.vulnerabilityNumber }}</span>
				<span class="ml-5">漏洞复测时间:&nbsp;{{ format(row.item.vulnerabilityRetestTime) }}</span>
				<span class="ml-5">漏洞修复时间:&nbsp;{{ format(row.item.vulnerabilityRepairTime) }}</span>
			</template>
			
			<template
				slot="repairTime"
				slot-scope="data"
			>{{ data.item.averageRepairTime }}个工作日</template>
		</b-table>

		<div class="mt-3">
			<b-pagination 
				v-model="currentPage" 
				:total-rows="rows" 
				align="center"
				:per-page="perPage"
				aria-controls="admin-overview-table"
			></b-pagination>
		</div>
  </div>
</template>

<script>
import bocData from '../../../../../plugin/backend/boc.json';

export default {
	data() {
		return {
			bocData,
			perPage: 9,
			currentPage: 1,
		}
	},
	computed: {
		rows() {
			return this.bocData.length;
		}		
	},
}
</script>

<style>

</style>
